export const meta = {
  emoji: "ğŸ‘€",
  title: "ì œëŒ€ë¡œ ëœ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„í•˜ê¸°",
  date: "2025-01-11",
  preview: "useSearchParamsë¥¼ í†µí•´ ì œëŒ€ë¡œ í˜ì´ì§€ë„¤ì´ì…˜ì„ êµ¬í˜„í•´ë³´ì•˜ë‹¤.",
  tag: "Kioschool",
};

<Header {...meta} />

## ë¬¸ì œ 1 - ì¿¼ë¦¬ ìŠ¤íŠ¸ë§

í˜ì´ì§€ë„¤ì´ì…˜ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ `useSearchParams`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì„ ê´€ë¦¬í•˜ê³  ìˆë‹¤. í˜ì´ì§€ë„¤ì´ì…˜ì€ ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ í´ë¦­í•  ë•Œë§ˆë‹¤ URLì´ ë°”ë€Œì–´ì•¼ í•˜ë©°, ê·¸ì— ë”°ë¼ API ìš”ì²­ë„ ë°œìƒí•´ì•¼ í•œë‹¤.

`super-admin/user?page=0`ì—ì„œ `page` í‚¤ ê°’ì€ API í†µì‹ ì„ í•˜ëŠ” ì»¤ìŠ¤í…€ í›…ì—ì„œ ë°”ê¿”ì£¼ê³  ìˆì—ˆë‹¤.

```tsx
const response = superAdminApi
  .get<PaginationResponse<User>>("/users", { params })
  .then((res) => {
    searchParams.set("page", params.page.toString());
    setSearchParams(searchParams);
    return res.data;
  });
```

ì´ë ‡ê²Œ í•˜ë‹¤ ë³´ë‹ˆ, ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ë°”ë¡œ URLì´ ë‘ ë²ˆ ë°”ë€Œê²Œ ë˜ëŠ” ê²ƒì´ì—ˆë‹¤.

ê´€ë¦¬ í˜ì´ì§€(`/super-admin/manage`)ì—ì„œ ì „ì²´ ì‚¬ìš©ì ì¡°íšŒ í˜ì´ì§€(`/super-admin/user?page=0`)ë¡œ ë„˜ì–´ê°€ëŠ” ìˆœê°„ì„ ì‚´í´ë³´ì.

ì‚¬ìš©ì ì¡°íšŒ í´ë¦­ ì‹œ `super-admin/manage` â†’ `super-admin/user` ë¡œ í•œ ë²ˆ ë°”ë€Œê³ , 0ë²ˆ pageì˜ ì‚¬ìš©ì ë°ì´í„°ë¥¼ fetch í•´ì˜¤ê³  **setSearchParams**ë¡œ `super-admin/user` â†’ `super-admin/user?page=0` ìœ¼ë¡œ ë˜ í•œ ë²ˆ ë” ë°”ë€ë‹¤.

<MDXVideo
  src="videos/fix-pagination/fix-pagination1.mp4"
  alt="ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ í˜ì´ì§€ ìƒíƒœ ê´€ë¦¬"
/>

ì´ë ‡ê²Œ ì´ ë‘ ë²ˆ ë°”ë€Œê²Œ ëœë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìê°€ ì „ì²´ ì‚¬ìš©ì ì¡°íšŒ í™”ë©´ì—ì„œ ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ì„ **í•œ ë²ˆ** ëˆŒë €ì„ ë•Œ, `super-admin/user?page=0` â†’ `super-admin/user` ë¡œ URLì´ ë°”ë€Œê²Œ ë˜ì–´ ì˜ë„í•œ ëŒ€ë¡œ ê´€ë¦¬ í˜ì´ì§€ë¡œ ëŒì•„ê°ˆ ìˆ˜ ì—†ê²Œ ëœë‹¤.

### í•´ê²° ë°©ë²•

ìœ„ ë¬¸ì œëŠ” `setSearchParams`ì— ì˜µì…˜ ê°ì²´ë¡œ `replace: true`ë¥¼ ë„˜ê²¨ì£¼ë©´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```jsx
setSearchParams(searchParams, { replace: true });
```

ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ history ìŠ¤íƒì— ìƒˆ í•­ëª©ì„ ì¶”ê°€í•˜ëŠ” ëŒ€ì‹  í˜„ì¬ í•­ëª©ì„ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.

## ë¬¸ì œ 2 - í˜ì´ì§€ë„¤ì´ì…˜ì˜ API ì¤‘ë³µ í˜¸ì¶œ ë¬¸ì œ

#### ë°œìƒí•œ ë¬¸ì œ

í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ ì¤‘ APIê°€ ë‘ ë²ˆì”© ìš”ì²­ë˜ëŠ” í˜„ìƒì´ ë°œìƒí–ˆë‹¤.

<MDXVideo
  src="videos/fix-pagination/fix-pagination2.mp4"
  alt="API ì¤‘ë³µ í˜¸ì¶œ ë¬¸ì œ"
/>

ë¬¸ì œì˜ ê·¼ë³¸ì ì¸ ì›ì¸ì€ ì•„ë˜ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ìˆœí™˜ êµ¬ì¡°ë‹¤

```tsx,title=SuperAdmin.tsx
useEffect(() => {
  const nowPage = Number(searchParams.get("page"));
  const searchValue = userInputRef.current?.value || "";

  fetchAndSetWorkspaces(nowPage, pageSize, searchValue, true);
}, [searchParams]);
```

```tsx,title=fetchAllWorkspaces
// fetchì™€ searchParams setì„ ë™ì‹œì— í•˜ê³  ìˆë‹¤.
const fetchAllWorkspaces = (page: number, size: number, name?: string, replace?: boolean) => {
  // ...

  const response = superAdminApi
    .get<PaginationResponse<Workspace>>('/workspaces', { params })
    .then((res) => {
      searchParams.set('page', params.page.toString());
      setSearchParams(searchParams, { replace });
      return res.data;
    })

  return response;
};
```

ì´ ì½”ë“œì˜ ë¬¸ì œì ì„ ë‹¨ê³„ë³„ë¡œ ì‚´í´ë³´ë©´:

1. `useEffect`ê°€ `searchParams`ë¥¼ ì˜ì¡´ì„± ë°°ì—´ì— í¬í•¨
2. ë‚´ë¶€ì—ì„œ `fetchAndSetWorkspaces` í•¨ìˆ˜ í˜¸ì¶œ
3. `fetchAndSetWorkspaces`ëŠ” API í˜¸ì¶œ í›„ `setSearchParams`ë¡œ URL ì¿¼ë¦¬ë¥¼ ì—…ë°ì´íŠ¸
4. `searchParams`ê°€ ë³€ê²½ë˜ë©´ ë‹¤ì‹œ `useEffect` íŠ¸ë¦¬ê±°
5. ê·¸ ê²°ê³¼ APIê°€ ë˜ë‹¤ì‹œ í˜¸ì¶œë¨

<MDXImage
  src="/images/fix-pagination/fix-pagination1.png"
  alt="API ì¤‘ë³µ í˜¸ì¶œ ë¬¸ì œ1"
/>

#### ì˜ˆìƒë˜ëŠ” ê²°ê³¼ì™€ ì‹¤ì œ ë°œìƒí•œ í˜„ìƒ

ì´ë¡ ì ìœ¼ë¡œëŠ” ì´ëŸ° êµ¬ì¡°ê°€ ë¬´í•œ ë£¨í”„ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤

> `useEffect` ì‹¤í–‰ â†’ fetchAndSet í˜¸ì¶œ â†’ `setSearchParams`ë¡œ `searchParams` ë³€ê²½ â†’ `useEffect` ë‹¤ì‹œ ì‹¤í–‰ â†’ ë¬´í•œ ë°˜ë³µ...

í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” APIê°€ ë‹¨ 2ë²ˆë§Œ í˜¸ì¶œë˜ê³  ë©ˆì·„ë‹¤. ì™œ ê·¸ëŸ´ê¹Œ?

ê·¸ ì´ìœ ëŠ” `useSearchParams` í›…ì˜ ë‚´ë¶€ êµ¬í˜„ ë•Œë¬¸ì´ë‹¤. ì´ í›…ì—ì„œ ë°˜í™˜í•˜ëŠ” `searchParams`ì™€ `setSearchParams`ëŠ” ê°ê° `useMemo`ì™€ `useCallback`ìœ¼ë¡œ ìµœì í™”ë˜ì–´ ìˆë‹¤. ë”°ë¼ì„œ ë™ì¼í•œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ê°’ì— ëŒ€í•´ì„œëŠ” ì°¸ì¡°ê°€ ìœ ì§€ëœë‹¤.

#### ì‹¤ì œ ë°œìƒí•œ í˜¸ì¶œ ê³¼ì •

1. ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ â†’ `useEffect` ì‹¤í–‰
2. `fetchAndSetWorkspaces` í˜¸ì¶œ [ì²« ë²ˆì§¸ API í˜¸ì¶œ]
3. API ì‘ë‹µ í›„ `setSearchParams`ë¡œ URL ì¿¼ë¦¬ ì—…ë°ì´íŠ¸
4. `searchParams` ë³€ê²½ ê°ì§€ â†’ `useEffect` ì¬ì‹¤í–‰
5. `fetchAndSetWorkspaces` ë‘ ë²ˆì§¸ í˜¸ì¶œ [ë‘ ë²ˆì§¸ API í˜¸ì¶œ]
6. ë‘ ë²ˆì§¸ API ì‘ë‹µ í›„ `setSearchParams` í˜¸ì¶œí•˜ì§€ë§Œ, ì´ë¯¸ ê°™ì€ ê°’ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ `searchParams`ì˜ ì°¸ì¡°ëŠ” ë³€ê²½ë˜ì§€ ì•ŠìŒ
7. ì˜ì¡´ì„± ë°°ì—´ì˜ ê°’ ë³€í™” ì—†ìŒ â†’ ë” ì´ìƒ `useEffect` ì‹¤í–‰ ì•ˆ ë¨

ì´ë ‡ê²Œ í•´ì„œ ë¬´í•œ ë£¨í”„ ëŒ€ì‹  APIê°€ ë‹¨ ë‘ ë²ˆë§Œ í˜¸ì¶œë˜ëŠ” í˜„ìƒì´ ë°œìƒí–ˆë‹¤.

### í•´ê²° ë°©ë²•

ì§€ê¸ˆì€ `useSearchParams`ì˜ ìµœì í™” ë•ë¶„ì— API ìš”ì²­ì´ 2ë²ˆ ì´ë£¨ì–´ì§€ëŠ” ë¶€ì‘ìš©ë§Œ ìˆì§€ë§Œ ì´ëŒ€ë¡œ ë°©ì¹˜í•˜ë©´ ë‚˜ì¤‘ì—ëŠ” ì‹¬ê°í•œ ê²°ê³¼ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ `fetchAndSetWorkspaces`ì—ì„œëŠ” fetchë§Œ í•˜ê³ , `setSearchParams`ëŠ” ê° ì»´í¬ë„ŒíŠ¸ì—ì„œ ê´€ë¦¬í•˜ë„ë¡ ì±…ì„ì„ ë¶„ë¦¬í–ˆë‹¤.

```tsx,title=SuperAdminWorkspace.tsx
  useEffect(() => {
    const nowPage = Number(searchParams.get('page'));
    const searchValue = searchParams.get('name') || '';

    fetchAllWorkspaces(nowPage, pageSize, searchValue);
    // ì‚¬ì‹¤ searchParamsëŠ” useMemoë¡œ ë™ê²°ë˜ì–´ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì—, toString()ì„ í•´ì¤„ í•„ìš”ëŠ” ì—†ë‹¤.
}, [searchParams.toString()]);

```

```tsx,title=SuperAdminSearchBar.tsx
function SuperAdminSearchBar() {
  const fetchContentsByName = (e: React.KeyboardEvent<HTMLInputElement>) => {
    // ê²€ìƒ‰ì–´ë¡œ ê²€ìƒ‰í•˜ë©´ 0ë²ˆ pageë¡œ ì´ë™
    searchParams.set('page', '0');

    // nameì˜ ìœ ë¬´ì— ë”°ë¼ name params ì¶”ê°€ ë° ì‚­ì œ
    if (inputRef.current?.value === '') {
      searchParams.delete('name');
    } else {
      searchParams.set('name', String(inputRef.current?.value));
    }

    // fetchAndSetëŒ€ì‹  setë§Œ ìˆ˜í–‰
    setSearchParams(searchParams);
  };
```

```tsx,title=fetchAllWorkspaces
const fetchAllWorkspaces = (page: number, size: number, name?: string) => {
    // fetchë§Œ ìˆ˜í–‰í•˜ê³ , setSearchParamsëŠ” ê° ì»´í¬ë„ŒíŠ¸ì—ì„œ ê´€ë¦¬í•˜ë„ë¡ ì±…ì„ ë¶„ë¦¬
    const response = superAdminApi
      .get<PaginationResponse<Workspace>>('/workspaces', { params })
      .then((res) => {
        return res.data;
      })

    return response;
  };
```

<MDXImage
  src="/images/fix-pagination/fix-pagination2.png"
  alt="API ì¤‘ë³µ í˜¸ì¶œ ë¬¸ì œ2"
/>

<MDXVideo
  src="videos/fix-pagination/fix-pagination3.mp4"
  alt="ìµœì¢… ê°œì„ ëœ í˜ì´ì§€ë„¤ì´ì…˜ ë°ëª¨"
/>
ì±…ì„ì„ ë¶„ë¦¬í•˜ì—¬ ì¢€ ë” ë‚˜ì€ ì½”ë“œê°€ ë˜ì—ˆê³ , ëª¨ë“ ê²Œ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•œë‹¤!

## í›„ê¸°

ë¬¸ì œ ì •ì˜ë¶€í„° í•´ê²°ì±… ì ìš©ê¹Œì§€ ê³¼ì •ì„ í†µí•´ `useSearchParams` í›…ì˜ ë™ì‘ ì›ë¦¬ë¥¼ ê¹Šì´ ì´í•´í•  ìˆ˜ ìˆì—ˆê³ , ì±…ì„ ë¶„ë¦¬ì˜ ì¤‘ìš”ì„±ì„ ë‹¤ì‹œ í•œë²ˆ ëŠê¼ˆë‹¤. ì ì  ë” ê¹Šê²Œ ìƒê°í•˜ëŠ” íƒœë„ë¥¼ ê°–ì¶”ë ¤ê³  ë…¸ë ¥í•˜ëŠ” ì¤‘ì´ë‹¤.

ì°¸ê³ ë§í¬

- https://github.com/remix-run/react-router/blob/main/packages/react-router/lib/hooks.tsx
- https://alexsidorenko.com/blog/react-render-usememo
- https://joong-sunny.github.io/react/react1/#google_vignette
