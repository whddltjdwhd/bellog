export const meta = {
  emoji: "ğŸ‘€",
  title: "ì œëŒ€ë¡œ ëœ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„í•˜ê¸°",
  date: "2025-01-11",
  preview: "useSearchParamsë¥¼ í†µí•´ ì œëŒ€ë¡œ í˜ì´ì§€ë„¤ì´ì…˜ì„ êµ¬í˜„í•´ë³´ì•˜ë‹¤.",
  tag: "Kioschool",
};

<Header {...meta} />

## ë¬¸ì œ 1 - ì¿¼ë¦¬ ìŠ¤íŠ¸ë§

---

ê¸°ì¡´ì—ëŠ” pagination í˜ì´ì§€ì—ì„œ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì— page ê°’ì„ ì €ì¥í•˜ì—¬ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆì—ˆë‹¤.

`http://localhost:3000/super-admin/user?page=0`

í•´ë‹¹ `page` í‚¤ ê°’ì€ API í†µì‹ ì„ í•˜ëŠ” ì»¤ìŠ¤í…€ í›…ì—ì„œ ë°”ê¿”ì£¼ê³  ìˆì—ˆë‹¤.

```tsx
const response = superAdminApi
  .get<PaginationResponse<User>>("/users", { params })
  .then((res) => {
    searchParams.set("page", params.page.toString());
    setSearchParams(searchParams);
    return res.data;
  });
```

ì´ë ‡ê²Œ í•˜ë‹¤ ë³´ë‹ˆ, ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ë°”ë¡œ URLì´ ë‘ ë²ˆ ë°”ë€Œê²Œ ë˜ëŠ” ê²ƒì´ì—ˆë‹¤.

ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ì „ì²´ ì‚¬ìš©ì ì¡°íšŒ í˜ì´ì§€ë¡œ ë„˜ì–´ê°€ëŠ” ìˆœê°„ì„ ì‚´í´ë³´ì.

- **ê´€ë¦¬ í˜ì´ì§€ URL**: `http://localhost:3000/super-admin/manage`
- **ì‚¬ìš©ì ì¡°íšŒ URL**: `http://localhost:3000/super-admin/user?page=0`

ì‚¬ìš©ì ì¡°íšŒ í´ë¦­ ì‹œ `super-admin/manage` â†’ `super-admin/user` ë¡œ í•œ ë²ˆ ë°”ë€Œê³ , 0ë²ˆ pageì˜ ì‚¬ìš©ì ë°ì´í„°ë¥¼ fetch í•´ì˜¤ê³  **setSearchParams**ë¡œ `super-admin/user` â†’ `super-admin/user?page=0` ìœ¼ë¡œ ë˜ í•œ ë²ˆ ë” ë°”ë€ë‹¤.

<MDXVideo
  src="videos/fix-pagination/fix-pagination1.mp4"
  alt="ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ í˜ì´ì§€ ìƒíƒœ ê´€ë¦¬"
/>

ì´ë ‡ê²Œ ì´ ë‘ ë²ˆ ë°”ë€Œê²Œ ëœë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìê°€ ì „ì²´ ì‚¬ìš©ì ì¡°íšŒ í™”ë©´ì—ì„œ ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ì„ **í•œ ë²ˆ** ëˆŒë €ì„ ë•Œ, `super-admin/user?page=0` â†’ `super-admin/user` ë¡œ URLì´ ë°”ë€Œê²Œ ë˜ì–´ ì˜ë„í•œ ëŒ€ë¡œ ê´€ë¦¬ í˜ì´ì§€ë¡œ ëŒì•„ê°ˆ ìˆ˜ ì—†ê²Œ ëœë‹¤.

### í•´ê²° ë°©ë²•

---

ìœ„ ë¬¸ì œëŠ” `setSearchParams`ì— ì˜µì…˜ ê°ì²´ë¡œ `replace: true`ë¥¼ ë„˜ê²¨ì£¼ë©´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```jsx
setSearchParams(searchParams, { replace: true });
```

ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ history ìŠ¤íƒì— ìƒˆ í•­ëª©ì„ ì¶”ê°€í•˜ëŠ” ëŒ€ì‹  í˜„ì¬ í•­ëª©ì„ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ê°œë°œí•˜ë‹¤ ë³´ë‹ˆ ë˜ ë‹¤ë¥¸ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆë‹¤.

## ë¬¸ì œ 2 - API ì¤‘ë³µ ìš”ì²­

---

APIê°€ ë‘ ë²ˆì”© ìš”ì²­ë˜ëŠ” í˜„ìƒì´ ë°œìƒí–ˆë‹¤.

<MDXVideo
  src="videos/fix-pagination/fix-pagination2.mp4"
  alt="API ì¤‘ë³µ í˜¸ì¶œ ë¬¸ì œ"
/>

ê·¸ ì›ì¸ì€ `SuperAdminWorkspace` ì»´í¬ë„ŒíŠ¸ì—ì„œ `useEffect`ì— `searchParams`ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ë„£ê³ , ë‚´ë¶€ì—ì„œ `fetchAndSetWorkspaces` í˜¸ì¶œ í›„ `setSearchParams`ë¡œ ì¿¼ë¦¬ë¥¼ ë³€ê²½í–ˆê¸° ë•Œë¬¸ì´ë‹¤. ì´ë¡œ ì¸í•´ `searchParams`ê°€ ë³€ê²½ë˜ê³  `useEffect`ê°€ ì¬ì‹¤í–‰ë˜ì–´ ë˜ë‹¤ì‹œ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ìˆœí™˜ì´ ë°œìƒí–ˆë‹¤.

```tsx,title=SuperAdminWorkspace.tsx
useEffect(() => {
  const nowPage = Number(searchParams.get("page"));
  const searchValue = userInputRef.current?.value || "";

  fetchAndSetWorkspaces(nowPage, pageSize, searchValue, true);
}, [searchParams]);
```

```tsx,title=fetchAndSetWorkspaces
// fetchì™€ searchParams setì„ ë™ì‹œì— í•˜ê³  ìˆë‹¤.
 const fetchAllWorkspaces = (page: number, size: number, name?: string, replace?: boolean) => {
    . . .

    const response = superAdminApi
      .get<PaginationResponse<Workspace>>('/workspaces', { params })
      .then((res) => {
        searchParams.set('page', params.page.toString());
        setSearchParams(searchParams, { replace });
        return res.data;
      })

    return response;
  };
```

ìœ„ì™€ ê°™ì€ êµ¬ì¡°ëŠ” ë¬´í•œ API í˜¸ì¶œ ë° ë Œë”ë§ì´ ë°œìƒí•˜ê²Œ ëœë‹¤.

`useEffect`ì‹¤í–‰ â†’ `fetchAndSet`í˜¸ì¶œ â†’ `setSearchParams`ì—ì„œ `searchParams`ë³€ê²½ â†’ `useEffect`ì‹¤í–‰ â†’ `fetchAndSet`í˜¸ì¶œ â†’ . . .

**_ê·¸ëŸ¬ë‚˜ ê·¸ëŸ° ì¼ì€ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ë‹¤._** ê·¸ ì´ìœ ê°€ ë­˜ê¹Œ?

ê·¸ê²ƒì€ ë°”ë¡œ useSearchParamsì—ì„œ ë°˜í™˜ë˜ëŠ” searchParamsì™€ setSearchParamsëŠ” ê°ê° useMemoì™€ useCallBackì´ ì ìš©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ([useSearchParams ë¶„ì„](https://www.notion.so/useSearchParams-1adb0b4f310a4b34abcd1904aa7bdfd8?pvs=21))

ê·¸ë˜ì„œ ë‚˜ëŠ” ìš´ì´ ì¢‹ê²Œë„? 2ë²ˆì˜ ì¤‘ë³µëœ APIí˜¸ì¶œë§Œ ë°œìƒí•œ ê²ƒì´ë‹¤. í•´ë‹¹ API í˜¸ì¶œì˜ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ ëì„ ë•Œ **useEffect**ì‹¤í–‰ â†’ **fetchAndSet**í•¨ìˆ˜ ì‹¤í–‰`[1]` â†’ **setSearchParams**ë¡œ **searchParams**ë³€ê²½ (ìºì‹± ì‹œì‘) â†’ **useEffect**ì‹¤í–‰ â†’ **fetchAndSet**í•¨ìˆ˜ ì‹¤í–‰`[2]` â†’ **setSearchParams**ë¡œ **seachParams**ë³€ê²½ (ì´ì „ê³¼ ë™ì¼í•œ ê°’ì´ë¯€ë¡œ ìºì‹± ìœ ì§€)

### í•´ê²° ë°©ë²•

---

**useEffect**ì—ì„œë„ fetchë¥¼ í•˜ê³ , **Pagination** ì»´í¬ë„ŒíŠ¸, ì‹¬ì§€ì–´ **SuperAdminSearchBar**(ê²€ìƒ‰ë°”) ì»´í¬ë„ŒíŠ¸ì—ì„œë„ í˜ì´ì§€ í´ë¦­ ì‹œ fetchë¥¼ í•˜ê³  ìˆë‹¤. ì´ëŸ° êµ¬ì¡°ëŠ” ì •ë§ ì¢‹ì•„ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.

ì§€ê¸ˆì€ ìš´ì´ ì¢‹ì•„ì„œ API ìš”ì²­ì´ 2ë²ˆ ì´ë£¨ì–´ì§€ëŠ” ë¶€ì‘ìš©ë§Œ ìˆì§€ë§Œ ë‚˜ì¤‘ì—ëŠ” ì—„ì²­ ì‹¬ê°í•œ ê²°ê³¼ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ì±…ì„ì„ ë¶„ë¦¬í•˜ì—¬, **fetch** ë¡œì§ì€ ì˜¤ì§ `useEffect` ë‚´ì—ì„œë§Œ ì‹¤í–‰ë˜ê²Œ í•˜ê³ , í˜ì´ì§€ ë³€ê²½ì´ë‚˜ ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œì—ëŠ” `searchParams`ë§Œ ë³€ê²½í•˜ì—¬ `useEffect`ë¥¼ íŠ¸ë¦¬ê±°í•˜ë„ë¡ êµ¬ì¡°ë¥¼ ê°œì„ í–ˆë‹¤.

#### BEFORE

```tsx,title=SuperAdminWorkspace.tsx
useEffect(() => {
  const nowPage = Number(searchParams.get("page"));
  const searchValue = userInputRef.current?.value || "";

  fetchAndSetWorkspaces(nowPage, pageSize, searchValue, true);
}, [searchParams]);
```

```tsx,title=Pagination.tsx
    <Pagination
      totalPageCount={workspaces.totalPages}
      paginateFunction={(page: number) => {
        fetchAndSetWorkspaces(page, pageSize, userInputRef.current?.value);
      }}
    />
```

```tsx,title=SuperAdminSearchBar.tsx
    // ê²€ìƒ‰ì°½ ì»´í¬ë„ŒíŠ¸
    const SuperAdminSearchBar = forwardRef<HTMLInputElement, SuperAdminSearchBarProps>((props, ref) => {
    // fetchContents === fetchAndSet()
    props.fetchContents(0, 6, ref.current?.value, false);
  };
```

#### AFTER

```tsx,title=SuperAdminWorkspace.tsx
  useEffect(() => {
    const nowPage = Number(searchParams.get('page'));
    const searchValue = searchParams.get('name') || '';

    fetchAndSetWorkspaces(nowPage, pageSize, searchValue);
    // ì‚¬ì‹¤ searchParamsëŠ” useMemoë¡œ ë™ê²°ë˜ì–´ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì—, toString()ì„ í•´ì¤„ í•„ìš”ëŠ” ì—†ë‹¤.
  }, [searchParams.toString()]);
```

```tsx,title=Pagination.tsx
    <Pagination
      totalPageCount={workspaces.totalPages}
      paginateFunction={(page: number) => {
        searchParams.set('page', page.toString());
        setSearchParams(searchParams);
      }}
    />
```

```tsx,title=SuperAdminSearchBar.tsx
function SuperAdminSearchBar() {
  const fetchContentsByName = (e: React.KeyboardEvent<HTMLInputElement>) => {
    // ê²€ìƒ‰ì–´ë¡œ ê²€ìƒ‰í•˜ë©´ 0ë²ˆ pageë¡œ ì´ë™
    searchParams.set('page', '0');

    // nameì˜ ìœ ë¬´ì— ë”°ë¼ name params ì¶”ê°€ ë° ì‚­ì œ
    if (inputRef.current?.value === '') {
      searchParams.delete('name');
    } else {
      searchParams.set('name', String(inputRef.current?.value));
    }
    // fetchAndSetëŒ€ì‹  setë§Œ ìˆ˜í–‰
    setSearchParams(searchParams);
  };
```

```tsx,title=fetchAllWorkspaces
  const fetchAllWorkspaces = (page: number, size: number, name?: string) => {

    const response = superAdminApi
      .get<PaginationResponse<Workspace>>('/workspaces', { params })
      .then((res) => {
        return res.data;
      })

    return response;
  };
```

<MDXVideo
  src="videos/fix-pagination/fix-pagination3.mp4"
  alt="ìµœì¢… ê°œì„ ëœ í˜ì´ì§€ë„¤ì´ì…˜ ë°ëª¨"
/>
ì±…ì„ì„ ë¶„ë¦¬í•˜ì—¬ ì¢€ ë” ë‚˜ì€ ì½”ë“œê°€ ë˜ì—ˆê³ , ëª¨ë“ ê²Œ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•œë‹¤!

## í›„ê¸°

---

ë¬¸ì œ ì •ì˜ë¶€í„° í•´ê²°ì±… ì ìš©ê¹Œì§€ ê³¼ì •ì„ í†µí•´ `useSearchParams` í›…ì˜ ë™ì‘ ì›ë¦¬ë¥¼ ê¹Šì´ ì´í•´í•  ìˆ˜ ìˆì—ˆê³ , ì±…ì„ ë¶„ë¦¬ì˜ ì¤‘ìš”ì„±ì„ ë‹¤ì‹œ í•œë²ˆ ëŠê¼ˆë‹¤. ì ì  ë” ê¹Šê²Œ ìƒê°í•˜ëŠ” íƒœë„ë¥¼ ê°–ì¶”ë ¤ê³  ë…¸ë ¥í•˜ëŠ” ì¤‘ì´ë‹¤.

ì°¸ê³ ë§í¬

- https://github.com/remix-run/react-router/blob/main/packages/react-router/lib/hooks.tsx
- https://alexsidorenko.com/blog/react-render-usememo
- https://joong-sunny.github.io/react/react1/#google_vignette
